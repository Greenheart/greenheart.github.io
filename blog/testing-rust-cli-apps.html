<!doctype html>
<html lang="en" class="dark">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/images/favicon.svg" type="image/svg+xml" />
        <link rel="icon" href="/images/favicon-32x32.png" type="image/png" />
        <link rel="icon" href="/favicon.ico" />
        <meta name="theme-color" content="#5ac75f" />
        <meta name="color-scheme" content="dark light" />
        <script>
            document.documentElement.classList.toggle(
                'dark',
                localStorage.theme === 'dark' ||
                    (!('theme' in localStorage) &&
                        window.matchMedia('(prefers-color-scheme: dark)')
                            .matches),
            )
        </script>
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/images/compass-icon-square.svg"
        />
        <link
            href="/feed.json"
            type="application/feed+json"
            rel="alternate"
            title="Blog feed (JSON)"
        />
        <link
            href="/feed.atom"
            type="application/atom+xml"
            rel="alternate"
            title="Blog feed (Atom)"
        />
        
		<link href="../_app/immutable/assets/0.GlYlMjJf.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.ByFM-NPI.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bi7ERf7Z.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/GZG48BUc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Djzs_vta.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BcMWtO7v.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.DDRSfoAz.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/imt8fmZx.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B-oRaJiq.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BlxXD2Cz.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BBOWcguE.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bp23vAW-.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B3ETRlH4.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CR4KfHPE.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.Lbh_PqlV.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/kWG-pE-1.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/lpmQg3aL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DLT3QoAq.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/2zj_Puj0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BfGE2GYo.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D7Pvki5j.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D8-v3CQz.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/5.Cd2OiDLv.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DkYcvyUU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CCBpcK_s.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/0nxtk5sR.js"><!--12qhfyh--><meta name="fediverse:creator" content="@Greenheart@fosstodon.org"/><!----><!--1i4ddgx--><!--[--><!--]--> <!--[--><meta name="robots" content="index,follow"/><!--]--> <!--[--><meta name="description" content="Experienced fullstack developer, curious about how tech, systems thinking and Doughnut design for business can be combined to create a positive impact."/><!--]--> <!--[--><link rel="canonical" href="http://sveltekit-prerender/blog/testing-rust-cli-apps"/><!--]--> <!--[!--><!--]--> <!--[!--><!--]--> <!--[!--><!--]--> <!--[!--><!--]--> <!--[!--><!--]--> <!--[--><!--[--><meta property="og:url" content="http://sveltekit-prerender/blog/testing-rust-cli-apps"/><!--]--> <!--[--><meta property="og:type" content="website"/> <!--[!--><!--[!--><!--[!--><!--[!--><!--]--><!--]--><!--]--><!--]--><!--]--> <!--[--><meta property="og:title" content="Testing Rust-based CLI applications using temporary directories"/><!--]--> <!--[--><meta property="og:description" content="Experienced fullstack developer, curious about how tech, systems thinking and Doughnut design for business can be combined to create a positive impact."/><!--]--> <!--[!--><!--]--> <!--[!--><!--]--> <!--[!--><!--]--> <!--[!--><!--]--> <!--[!--><!--]--><!--]--> <!--[!--><!--]--> <!--[!--><!--]--><!----><title>Testing Rust-based CLI applications using temporary directories · Samuel Plumppu - Sustainability Entrepreneur &amp; Fullstack Developer</title>
    </head>

    <body
        class="bg-honeydew dark:bg-evergreen"
        data-sveltekit-preload-data="hover"
    >
        <div id="svelte" style="display: contents"><!--[--><!--[--><!----><!----> <header class="xs:text-base 2xs:justify-between mx-auto flex max-w-6xl flex-1 flex-wrap justify-center gap-x-2 gap-y-4 p-4 text-sm svelte-12qhfyh"><a href="/" class="link"><!---->Samuel Plumppu<!----></a><!----> <nav class="xs:space-x-4 flex space-x-2"><a href="/subscribe" title="Subscribe (Atom / JSON)" aria-label="Subscribe (Atom / JSON)" class="link flex"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" class="size-4" viewBox="0 0 24 24" aria-hidden="true"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 11a9 9 0 0 1 9 9M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></g></svg><!----></a><!----> <!--[--><a href="/blog" class="link"><!---->Blog<!----></a><a href="/about" class="link"><!---->About<!----></a><a href="/talks" class="link"><!---->Talks<!----></a><!--]--> <button title="Toggle theme from dark to light" aria-label="Toggle theme from dark to light" class="cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" class="size-5" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10m0-1.5v-17a8.5 8.5 0 0 1 0 17"></path></svg></button><!----></nav></header> <div class="container mx-auto max-w-6xl p-4 pb-0"><!----><article class="prose prose-hr:border-yellow/60 sm:prose-lg lg:prose-xl prose-blockquote:text-current prose-strong:text-current prose-blockquote:bg-white dark:prose-blockquote:bg-carbon-black prose-blockquote:py-1 prose-blockquote:rounded-md prose-headings:text-current mx-auto mt-4 max-w-[75ch] text-base text-current marker:text-current"><h1>Testing Rust-based CLI applications using temporary directories</h1> <div class="flex flex-wrap items-center gap-x-2 gap-y-4 text-xs whitespace-nowrap sm:text-sm"><time datetime="2m" class="2xs:w-min w-full">2 min read</time> <span class="2xs:block hidden self-center">~</span> <div class="flex flex-nowrap gap-1"><span>Published <time datetime="2026-01-17T00:00:00.000Z">17 Jan 2026</time></span> <span><!--[--><!--[-->· Updated <time datetime="2026-01-18T03:42:21.000Z">18 Jan 2026</time><!--]--><!--]--></span></div></div> <!--[--><div class="xs:text-sm flex flex-wrap items-center gap-2 text-xs leading-3 sm:text-base my-4"><!--[--><span class="bg-white dark:bg-carbon-black rounded-xs p-1 sm:p-2">Rust</span><span class="bg-white dark:bg-carbon-black rounded-xs p-1 sm:p-2">Terminal</span><span class="bg-white dark:bg-carbon-black rounded-xs p-1 sm:p-2">Open Source</span><!--]--></div><!--]--><!----> <!----><article><p>I recently finished reading the book <a href="https://rust-cli.github.io/book/" class="link"><!---->Command Line Applications in Rust<!----></a><!---->, experimenting with the exercises and adding more test cases. While the testing chapter covers the <a href="https://rust-cli.github.io/book/tutorial/testing.html" class="link"><!---->basics of testing CLI apps<!----></a><!---->, it didn't show the full potential of the recommended crates <a href="https://crates.io/crates/assert_cmd" class="link"><!---->assert_cmd<!----></a><!---->, <a href="https://crates.io/crates/assert_fs" class="link"><!---->assert_fs<!----></a><!----> and <a href="https://crates.io/crates/predicates" class="link"><!---->predicates<!----></a><!---->.</p><p>Specifically, I wondered how to create a temporary directory with multiple nested subdirectories and files. This is very useful for testing CLI tools that scaffold projects. Or in the case of my current Rust project, building a simple Git clone to learn more about how Git works internally, how to structure unit and integration tests in Rust, and to practice using the language.</p><p>Since I'm used to reading technical documentation and learning new technologies, I found what I needed without too much trouble by exploring <a href="https://docs.rs/assert_fs/latest/assert_fs/struct.TempDir.html" class="link"><!---->docs.rs/assert_fs<!----></a><!----> to learn about temporary directories, and <a href="https://docs.rs/assert_cmd/latest/assert_cmd/cmd/struct.Command.html#method.current_dir" class="link"><!---->docs.rs/assert_cmd<!----></a><!----> for executing the CLI app in a specific working directory. However, this seemed like a good opportunity to improve the Rust CLI book itself, to make common testing techniques easier to discover for people who might be new(er) to programming and not yet comfortable with jumping into technical documentation. I remember how much I valued these types of friendly and accessible descriptions when I started more than a decade ago, and these days I think they are important to make software development more accessible.</p><p>So I ended up <a href="https://github.com/rust-cli/book/pull/284" class="link"><!---->contributing<!----></a><!----> a new section describing the following example to hopefully make the book even better. If you're curious about how it works, I encourage you to read the <a href="https://github.com/rust-cli/book/pull/284/files" class="link"><!---->full version<!----></a><!----> which gives some more context.</p><!----><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">#[test]</span></span>
<span class="line"><span style="color:#C678DD">fn</span><span style="color:#61AFEF"> find_content_in_file_of_tmp_dir</span><span style="color:#ABB2BF">() -> </span><span style="color:#E5C07B">Result</span><span style="color:#ABB2BF">&#x3C;(), </span><span style="color:#E5C07B">Box</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#C678DD">dyn</span><span style="color:#E06C75"> std</span><span style="color:#ABB2BF">::</span><span style="color:#E06C75">error</span><span style="color:#ABB2BF">::</span><span style="color:#E5C07B">Error</span><span style="color:#ABB2BF">>> {</span></span>
<span class="line"><span style="color:#C678DD">    let</span><span style="color:#E06C75"> cwd</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> assert_fs</span><span style="color:#ABB2BF">::</span><span style="color:#E5C07B">TempDir</span><span style="color:#ABB2BF">::</span><span style="color:#61AFEF">new</span><span style="color:#ABB2BF">()?;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    let</span><span style="color:#E06C75"> child_dir</span><span style="color:#56B6C2"> =</span><span style="color:#E06C75"> cwd</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">child</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"nested/child_dir"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">    let</span><span style="color:#E06C75"> child_file</span><span style="color:#56B6C2"> =</span><span style="color:#E06C75"> child_dir</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">child</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"sample.txt"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    child_file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">write_str</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"The first</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">test file.</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">Last line of first file."</span><span style="color:#ABB2BF">)?;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // Files can be nested several levels within the temporary directory</span></span>
<span class="line"><span style="color:#61AFEF">    assert!</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">child_file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">path</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">ends_with</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"nested/child_dir/sample.txt"</span><span style="color:#ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF">    cargo_bin_cmd!</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"grrs"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // Execute in the temporary directory</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">current_dir</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">cwd</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">path</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">arg</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"first"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">arg</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">child_file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">path</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">assert</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">success</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">stdout</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">predicate</span><span style="color:#ABB2BF">::</span><span style="color:#E5C07B">str</span><span style="color:#ABB2BF">::</span><span style="color:#61AFEF">contains</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#98C379">            "The first</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">Last line of first file."</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Ok</span><span style="color:#ABB2BF">(())</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre><!----><!----><p>Making this change was also a good opportunity to learn more about how <a href="https://github.com/rust-lang/mdBook" class="link"><!---->mdBook<!----></a><!----> works, which is commonly used for many Rust books and technical tutorials. I really enjoyed how fast it builds, and even runs tests for the code samples to verify everything works as expected. This makes technical writing such a smooth experience.</p><p>And speaking of the Git clone, it's coming together nicely and has already taught me a lot about both Rust programming and how to create integration tests that simulate a Git repository. In fact, these testing techniques already helped me catch a regression while refactoring to reuse some code between <code>git cat-file</code> and <code>git ls-tree</code>, so this knowledge has already proven useful!</p></article><!----></article> <!--[--><section class="dark:bg-carbon-black mx-auto mt-12 max-w-lg space-y-4 rounded-md bg-white p-4 text-center shadow-lg lg:text-lg"><h2 class="xs:text-2xl text-xl leading-none font-black tracking-tight md:text-3xl">Thank you for reading!</h2> <p><a href="https://fosstodon.org/@Greenheart" class="link compact"><!---->Let me know<!----></a><!----> if you have any questions
        or comments.</p> <p><span class="inline-flex flex-wrap items-center justify-center gap-1"><a href="/subscribe" class="link inline-flex items-center gap-1 compact"><img src="/images/feed.svg" alt="RSS/Atom feed icon" class="size-5"/>Subscribe<!----></a><!----> with your feed reader: <span class="inline-flex flex-nowrap items-center gap-0.5"><a href="/feed.atom" class="link self-center compact"><!---->Atom<!----></a><!---->/<a href="/feed.json" class="link self-center compact"><!---->JSON<!----></a><!----></span></span></p><!----> <p><a href="/blog" class="link compact"><!---->Read 17 more posts<!----></a><!----> or learn more <a href="/" class="link compact"><!---->about me<!----></a><!---->.</p> <p class="flex items-center justify-center gap-1"><a href="https://github.com/Greenheart/greenheart.github.io/tree/2021/src/content/posts/testing-rust-cli-apps.md" class="link inline-flex items-center gap-1 compact"><img src="/images/code-xml.svg" alt="Show code (Git)" class="size-5"/>View source<!----></a><!----> for this page.</p></section> <nav class="mx-auto grid max-w-5xl gap-8 pt-8 sm:grid-cols-2 sm:gap-4 lg:gap-8"><!--[--><a href="/blog/git-cms-tip-automatic-updated-at-timestamp" class="dark:bg-carbon-black group flex flex-col gap-4 rounded-md bg-white p-4 shadow-md transition-all duration-300 hover:shadow-xl"><span class="flex items-center gap-2 text-xs font-bold tracking-wide uppercase"><svg viewBox="0 0 24 24" width="1.2em" height="1.2em" class="size-5 shrink-0"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 18l-6-6l6-6"></path></svg><!----> Previous</span> <span class="group-hover:decoration-moss underline-offset-3 group-hover:underline">Git-based CMS tip: Automatic updatedAt timestamps with Git</span></a><!--]--> <!--[!--><div class="hidden sm:block"></div><!--]--></nav><!--]--><!----><!----></div> <footer class="container mx-auto max-w-6xl px-4 pb-8 text-center"><hr class="border-yellow mx-auto my-16 max-w-sm"/> <h2 class="xs:text-2xl mb-6 text-xl leading-none font-black tracking-tight text-balance sm:text-3xl lg:text-4xl">Let's co-create a sustainable future!</h2> <a href="#" class="bg-moss inline-flex transform-gpu justify-center justify-self-center rounded-md px-8 py-3 font-black text-black shadow-lg duration-150 ease-out hover:scale-105 hover:shadow-xl "><span class="whitespace-nowrap">Email me</span></a><!----> <p class="mt-8">© 2015 - 2026 Samuel Plumppu</p> <div class="flex flex-wrap items-center justify-center space-x-8 dark:invert my-8"><a href="https://matrix.to/#/@Greenheart:matrix.org" target="_blank" rel="noopener noreferrer" aria-label="Message me securely with the Matrix protocol"><img src="/images/matrix-logo.svg" alt="Matrix.org logo" class="h-6"/></a> <a href="https://github.com/Greenheart" target="_blank" rel="noopener noreferrer" aria-label="See my libre software at GitHub"><img src="/images/github.svg" alt="GitHub" class="aspect-square h-6"/></a> <a href="https://fosstodon.org/@Greenheart" target="_blank" rel="me noopener noreferrer" aria-label="Follow me on Mastodon"><img src="/images/mastodon-logo.svg" alt="Mastodon" class="aspect-square h-6"/></a> <a href="https://linkedin.com/in/samuelplumppu" target="_blank" rel="noopener noreferrer" aria-label="Connect with me on LinkedIn"><img src="/images/linkedin.svg" alt="LinkedIn" class="aspect-square h-6"/></a></div><!----> <p><span class="inline-flex flex-wrap items-center justify-center gap-1"><a href="/subscribe" class="link inline-flex items-center gap-1 compact"><img src="/images/feed.svg" alt="RSS/Atom feed icon" class="size-5"/>Subscribe<!----></a><!----> with your feed reader: <span class="inline-flex flex-nowrap items-center gap-0.5"><a href="/feed.atom" class="link self-center compact"><!---->Atom<!----></a><!---->/<a href="/feed.json" class="link self-center compact"><!---->JSON<!----></a><!----></span></span></p><!----></footer><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_10p894v = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.ByFM-NPI.js"),
						import("../_app/immutable/entry/app.DDRSfoAz.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
    </body>
</html>
