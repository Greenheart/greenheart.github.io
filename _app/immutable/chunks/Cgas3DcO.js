import{f as o,a as p}from"./Bp23vAW-.js";import"./kWG-pE-1.js";import{s as a,c as i,n as c,r}from"./GZG48BUc.js";import{C as e}from"./Bu2iz0Bf.js";const F="git-cms-tip-automatic-updated-at-timestamp",y={title:"Git-based CMS tip: Automatic updatedAt timestamps with Git",publishedAt:"2025-12-16",tags:["Git","Shell Scripting","TypeScript"],featured:!0},{title:u,publishedAt:g,tags:A,featured:E}=y;var d=o("<article><p>One of the main benefits of using a database to power either a backend API or a CMS is the ability to get consistent <code>updatedAt</code> timestamps for entries like posts, comments or other forms of content. Until recently, this has been one of the main features that made me consider database-powered CMSes and backends even in cases where 90% of the project would work much better with a Git-based CMS.</p><p>However, it turns out that even Git-based CMSes can get this functionality, with only a few lines of code. By taking advantage of the fact that Git tracks the modification time for each file in commits, we can get reliable results since there is a difference between the <em>commit timestamp</em> and the <em>filesystem modification timestamp</em>. This is needed since the filesystem likely will change more often, and might not even be reliable at all in CI or production environments.</p><p>This means that blogs and other projects using Git-based CMSes to store content in Git like Markdown, JSON or YAML now can get the <code>updatedAt</code> timestamp automatically. Since it's built into the <code>git</code> command, this works with any programming language where you can spawn child processes - or where you use a dedicated git library directly to get the same information.</p><h2>How to extract <code>updatedAt</code> by using <code>git log</code></h2><p>To keep things simple, this technique assumes your content is stored as separate files, like for example <code>posts/*.md</code>. However, it should also be possible to extract the git commit timestamp for specific lines within each file, perhaps by using the Git blame information.</p><p>For now though, let's focus on the simple use case with separate files like <code>posts/*.md</code>. If you group data together in to for example one big <code>posts.json</code> file, then the following code will only give you the modification time for the entire file. It might still be good enough for some kinds of data, but this is worth considering when modeling your data and how it's stored.</p><!><hr/><h2>Example implementation</h2><p>You could make use of this in Node.js and TypeScript like this:</p><!><p>While Git-based CMSes are no perfect solution for all problems, this makes them even more viable, simplifying apps and websites into low-cost and easy maintenance systems that don't require any server components or databases. This is ideal for resource-constrained environments, and happens to be great for security and performance too.</p></article>");function w(t){var s=d(),n=a(i(s),6);e(n,{codeHTML:`<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic"># Get the unix timestamps for when file was last modified.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># \`--follow\` allows us to take file renames into account.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># The extra \`--\` prevents the file name from clashing with</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># git flags or options.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">#</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># By sorting the timestamps, we can reliably find the</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># newest/oldest timestamp, even if the Git commits show in</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># a different order due to rebases/merges. When reversing</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># the sort, the most recent timestamp will be at the start,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># and can be retrieved with \`head -n1\`:</span></span>
<span class="line"><span style="color:#61AFEF">git</span><span style="color:#98C379"> log</span><span style="color:#D19A66"> --follow</span><span style="color:#D19A66"> --format=%ad</span><span style="color:#D19A66"> --date</span><span style="color:#98C379"> unix</span><span style="color:#D19A66"> --</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#98C379">FIL</span><span style="color:#ABB2BF">E> |</span><span style="color:#56B6C2">\\</span></span>
<span class="line"><span style="color:#61AFEF">    sort</span><span style="color:#D19A66"> --reverse</span><span style="color:#ABB2BF"> |</span><span style="color:#56B6C2">\\</span></span>
<span class="line"><span style="color:#61AFEF">    head</span><span style="color:#D19A66"> -n1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># To get the timestamp for when the file was created,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"># use \`tail -n1\` instead:</span></span>
<span class="line"><span style="color:#61AFEF">git</span><span style="color:#98C379"> log</span><span style="color:#D19A66"> --follow</span><span style="color:#D19A66"> --format=%ad</span><span style="color:#D19A66"> --date</span><span style="color:#98C379"> unix</span><span style="color:#D19A66"> --</span><span style="color:#ABB2BF"> &#x3C;</span><span style="color:#98C379">FIL</span><span style="color:#ABB2BF">E> |</span><span style="color:#56B6C2">\\</span></span>
<span class="line"><span style="color:#61AFEF">    sort</span><span style="color:#D19A66"> --reverse</span><span style="color:#ABB2BF"> |</span><span style="color:#56B6C2">\\</span></span>
<span class="line"><span style="color:#61AFEF">    tail</span><span style="color:#D19A66"> -n1</span></span>
<span class="line"></span></code></pre>`});var l=a(n,4);e(l,{codeHTML:`<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">execSync</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> 'node:child_process'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * Use Git to determine when a file was last modified.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> *</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * This is more accurate than using the file system,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * where changes happen more freqeuntly.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> *</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@param</span><span style="color:#E06C75;font-style:italic"> path</span><span style="color:#7F848E;font-style:italic"> The file path to operate on.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * </span><span style="color:#C678DD;font-style:italic">@returns</span><span style="color:#7F848E;font-style:italic"> The \`updatedAt\` Date, or undefined if the</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> * file has not yet been modified.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD">function</span><span style="color:#61AFEF"> getFileUpdatedAtFromGit</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">path</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // Get the most recent UNIX timestamp for when file was</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // modified in Git.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // By using \`--follow\`, we get the full history even if</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // the file was renamed. This uses the Git author timestamp,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // because the commit timestamp is not as accurate and</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // may change during rebases and merges</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // Timestamps are sorted since rebases/merges might have</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // caused commits to show in a different order</span></span>
<span class="line"><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> rawTimestamps</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> execSync</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#98C379">        \`git log --follow --format=%ad --date unix -- </span><span style="color:#C678DD">\${</span><span style="color:#E06C75">path</span><span style="color:#C678DD">}</span><span style="color:#98C379"> | sort --reverse\`</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ).</span><span style="color:#61AFEF">toString</span><span style="color:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // Sepearate entries and only keep valid ones</span></span>
<span class="line"><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> timestamps</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> rawTimestamps</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">split</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'</span><span style="color:#56B6C2">\\n</span><span style="color:#98C379">'</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">filter</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Boolean</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // If we only have one timestamp, the file was</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // just created and has not yet been updated.</span></span>
<span class="line"><span style="color:#C678DD">    if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">timestamps</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">length</span><span style="color:#56B6C2"> &#x3C;</span><span style="color:#D19A66"> 2</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD">        return</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // Git stores timestamps in seconds, so we need to</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // convert to ms to get the expected JS date.</span></span>
<span class="line"><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> updatedAt</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Date</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">parseInt</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">timestamps</span><span style="color:#ABB2BF">[</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">]) </span><span style="color:#56B6C2">*</span><span style="color:#D19A66"> 1000</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#E06C75"> updatedAt</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>`}),c(),r(s),p(t,s)}export{w as default,y as frontmatter,F as slug};
