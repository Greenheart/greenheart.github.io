import{S as mt,i as dt,s as ht,O as rn,w as K,x as X,y as aa,Q as ft,a3 as Vn,f as sa,t as ea,z as na,R as qn,k as p,q as t,a as k,l as c,m as l,r as o,h as s,c as m,n as C,b as r,D as e}from"./index-9503b135.js";import{P as wt}from"./_post-5fdf5fee.js";import{L as ba}from"./Link-6b9d6e3a.js";function yt(f){let i;return{c(){i=t("Bitwarden")},l(u){i=o(u,"Bitwarden")},m(u,d){r(u,i,d)},d(u){u&&s(i)}}}function gt(f){let i;return{c(){i=t("Web Crypto API")},l(u){i=o(u,"Web Crypto API")},m(u,d){r(u,i,d)},d(u){u&&s(i)}}}function bt(f){let i;return{c(){i=t("Remainder operator")},l(u){i=o(u,"Remainder operator")},m(u,d){r(u,i,d)},d(u){u&&s(i)}}}function _t(f){let i;return{c(){i=t("do…while")},l(u){i=o(u,"do…while")},m(u,d){r(u,i,d)},d(u){u&&s(i)}}}function vt(f){let i;return{c(){i=t("pagecrypt")},l(u){i=o(u,"pagecrypt")},m(u,d){r(u,i,d)},d(u){u&&s(i)}}}function Et(f){let i;return{c(){i=t("browsers newer than 2018")},l(u){i=o(u,"browsers newer than 2018")},m(u,d){r(u,i,d)},d(u){u&&s(i)}}}function $t(f){let i,u,d,W,h,y,ta,j,Ls,Qa,oa,Is,Za,ra,Ws,Ka,G,Bn=`<code class="language-js"><span class="token comment">// crypto.js</span>

<span class="token comment">/**
 * Get a reference to the Web Crypto API in any modern JS environment
 *
 * @returns An object implementing the Web Crypto API.
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadCrypto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>crypto<span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span>globalThis <span class="token operator">&amp;&amp;</span> globalThis<span class="token punctuation">.</span>crypto<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Running in browsers released after 2017, and other</span>
        <span class="token comment">// runtimes with &#96;globalThis&#96; like Deno or CloudFlare Workers</span>
        <span class="token keyword">const</span> crypto <span class="token operator">=</span> window<span class="token punctuation">.</span>crypto <span class="token operator">||</span> globalThis<span class="token punctuation">.</span>crypto

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span>crypto<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Running in Node.js >= 15</span>
        <span class="token keyword">const</span> nodeCrypto <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> nodeCrypto<span class="token punctuation">.</span>webcrypto
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadCrypto</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> crypto</code>`,Xa,pa,Gs,as,ca,Us,ss,la,Ms,es,U,Fn=`<code class="language-js"><span class="token comment">// generate-password.js</span>

<span class="token keyword">import</span> crypto <span class="token keyword">from</span> <span class="token string">'./crypto'</span>

<span class="token keyword">const</span> digits <span class="token operator">=</span> <span class="token string">'0123456789'</span>
<span class="token keyword">const</span> upper <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>
<span class="token keyword">const</span> lower <span class="token operator">=</span> upper<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">CHAR_SET</span> <span class="token operator">=</span> digits <span class="token operator">+</span> upper <span class="token operator">+</span> lower</code>`,ns,E,Vs,_a,qs,Js,va,Bs,Fs,Ea,zs,Ys,ts,M,zn=`<code class="language-js"><span class="token comment">/**
 * Generate a random password of a given length.
 *
 * @param &#123;number&#125; length The password length.
 * @param &#123;string&#125; characters The set of characters to pick from.
 * @returns A random password.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generatePassword</span><span class="token punctuation">(</span><span class="token parameter">length <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span> characters <span class="token operator">=</span> <span class="token constant">CHAR_SET</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> length <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">getRandomCharacter</span><span class="token punctuation">(</span>characters<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code>`,os,ia,Qs,rs,b,Zs,$a,Ks,Xs,Ca,ae,se,Ta,ee,ne,Pa,te,oe,ps,V,Yn=`<code class="language-js">
<span class="token comment">/**
 * Get a random character from a given set of characters.
 *
 * @param &#123;string&#125; characters The set of characters to pick from.
 * @returns A random character.
 */</span>
<span class="token keyword">function</span> <span class="token function">getRandomCharacter</span><span class="token punctuation">(</span><span class="token parameter">characters</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> randomNumber <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">getRandomValues</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> characters<span class="token punctuation">[</span>randomNumber <span class="token operator">%</span> characters<span class="token punctuation">.</span>length<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code>`,cs,w,re,Ra,pe,ce,ja,le,ie,Aa,ue,ke,xa,me,de,Sa,he,fe,Na,we,ye,ls,T,ge,Da,be,_e,A,ve,is,g,Ee,Oa,$e,Ce,Ha,Te,Pe,La,Re,je,Ia,Ae,xe,Wa,Se,Ne,us,q,Qn=`<code class="language-js"><span class="token keyword">const</span> characters <span class="token operator">=</span> <span class="token string">'...'</span>
<span class="token keyword">const</span> characterLength <span class="token operator">=</span> <span class="token number">40</span>

<span class="token keyword">const</span> randomNumber1 <span class="token operator">=</span> <span class="token number">39</span>
<span class="token keyword">const</span> randomNumber2 <span class="token operator">=</span> <span class="token number">40</span>


<span class="token keyword">const</span> index1 <span class="token operator">=</span> randomNumber1 <span class="token operator">%</span> characterLength <span class="token comment">// 39 % 40 = 39</span>
<span class="token keyword">const</span> index2 <span class="token operator">=</span> randomNumber2 <span class="token operator">%</span> characterLength <span class="token comment">// 40 % 40 = 0</span>

<span class="token keyword">const</span> first <span class="token operator">=</span> characters<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token comment">// Returns the last character</span>
<span class="token keyword">const</span> second <span class="token operator">=</span> characters<span class="token punctuation">[</span>index2<span class="token punctuation">]</span> <span class="token comment">// Returns the first character!</span></code>`,ks,ua,De,ms,x,Oe,Ga,He,Le,ds,ka,Ie,hs,J,Zn='<code class="language-js"><span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">%</span> characters<span class="token punctuation">.</span>length<span class="token punctuation">)</span></code>',fs,ma,We,ws,B,Kn='<code class="language-js"><span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token comment">// 240</span></code>',ys,_,Ge,Ua,Ue,Me,Ma,Ve,qe,Va,Je,Be,S,Fe,gs,F,Xn=`<code class="language-js"><span class="token comment">/**
 * Get a random character from a given set of characters.
 *
 * @param &#123;string&#125; characters The set of characters to pick from.
 * @returns A random character.
 */</span>
<span class="token keyword">function</span> <span class="token function">getRandomCharacter</span><span class="token punctuation">(</span><span class="token parameter">characters</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> randomNumber
    <span class="token comment">/**
     * Due to the repeating nature of results from the remainder
     * operator, we potentially need to regenerate the random number
     * several times. This is required to ensure all characters have
     * the same probability to get picked. Otherwise, the first
     * characters would appear more often, resulting in a weaker
     * password security.
     */</span>
    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
        randomNumber <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">getRandomValues</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>randomNumber <span class="token operator">>=</span> <span class="token number">256</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">%</span> characters<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> characters<span class="token punctuation">[</span>randomNumber <span class="token operator">%</span> characters<span class="token punctuation">.</span>length<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code>`,bs,da,ze,_s,ha,Ye,vs,z,at=`<code class="language-js"><span class="token comment">// generate-password.js</span>

<span class="token keyword">import</span> crypto <span class="token keyword">from</span> <span class="token string">'./crypto'</span>

<span class="token keyword">const</span> digits <span class="token operator">=</span> <span class="token string">'0123456789'</span>
<span class="token keyword">const</span> upper <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>
<span class="token keyword">const</span> lower <span class="token operator">=</span> upper<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">CHAR_SET</span> <span class="token operator">=</span> digits <span class="token operator">+</span> upper <span class="token operator">+</span> lower

<span class="token comment">/**
 * Generate a random password of a given length.
 *
 * @param &#123;number&#125; length The password length.
 * @param &#123;string&#125; characters The set of characters to pick from.
 * @returns A random password.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generatePassword</span><span class="token punctuation">(</span><span class="token parameter">length <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span> characters <span class="token operator">=</span> <span class="token constant">CHAR_SET</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> length <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">getRandomCharacter</span><span class="token punctuation">(</span>characters<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Get a random character from a given set of characters.
 *
 * @param &#123;string&#125; characters The set of characters to pick from.
 * @returns A random character.
 */</span>
<span class="token keyword">function</span> <span class="token function">getRandomCharacter</span><span class="token punctuation">(</span><span class="token parameter">characters</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> randomNumber
    <span class="token comment">/**
     * Due to the repeating nature of results from the remainder
     * operator, we potentially need to regenerate the random number
     * several times. This is required to ensure all characters have
     * the same probability to get picked. Otherwise, the first
     * characters would appear more often, resulting in a weaker
     * password security.
     */</span>
    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
        randomNumber <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">getRandomValues</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>randomNumber <span class="token operator">>=</span> <span class="token number">256</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">%</span> characters<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> characters<span class="token punctuation">[</span>randomNumber <span class="token operator">%</span> characters<span class="token punctuation">.</span>length<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code>`,Es,N,Qe,qa,Ze,Ke,$s,D,Xe,O,an,Cs,fa,sn,Ts,Y,st='<code class="language-shell"><span class="token function">npm</span> i pagecrypt</code>',Ps,H,en,L,nn,Rs,Q,et=`<code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> generatePassword <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'pagecrypt/core'</span>

<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token function">generatePassword</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span></code>`,js,wa,Ja,tn,As,ya,on,xs;return d=new ba({props:{href:"https://bitwarden.com/",rel:"nofollow",$$slots:{default:[yt]},$$scope:{ctx:f}}}),j=new ba({props:{href:"https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto",rel:"nofollow",$$slots:{default:[gt]},$$scope:{ctx:f}}}),A=new ba({props:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Remainder",rel:"nofollow",$$slots:{default:[bt]},$$scope:{ctx:f}}}),S=new ba({props:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/do...while",rel:"nofollow",$$slots:{default:[_t]},$$scope:{ctx:f}}}),O=new ba({props:{href:"https://github.com/greenheart/pagecrypt",rel:"nofollow",$$slots:{default:[vt]},$$scope:{ctx:f}}}),L=new ba({props:{href:"https://caniuse.com/cryptography",rel:"nofollow",$$slots:{default:[Et]},$$scope:{ctx:f}}}),{c(){i=p("p"),u=t("Strong, cryptographically safe passwords are an essential foundation to live a secure digital life. With an open source password manager like "),K(d.$$.fragment),W=t(", it’s never been more accessible to generate unique, strong passwords for every online account, and then storing them in your password vault."),h=k(),y=p("p"),ta=t("But what if you want to add password generation directly to your web app? That’s recently been getting much more accessible as well thanks to the standard "),K(j.$$.fragment),Ls=t("."),Qa=k(),oa=p("h2"),Is=t("Use the Web Crypto API in Any Environment"),Za=k(),ra=p("p"),Ws=t("In order to make the generator work in both browsers and Node.js, we need an abstraction. This ensures we can use the same Web Crypto API no matter where the generator is used."),Ka=k(),G=p("pre"),Xa=k(),pa=p("h2"),Gs=t("Creating a Password by Selecting Random Characters"),as=k(),ca=p("p"),Us=t("The way our generator is going to work is by creating an array of a given length (matching the password length), and then filling it with random characters."),ss=k(),la=p("p"),Ms=t("First, we’ll import the crypto abstraction and define the character set we want to use."),es=k(),U=p("pre"),ns=k(),E=p("p"),Vs=t("Using "),_a=p("code"),qs=t("Array.from()"),Js=t(", we can provide a "),va=p("code"),Bs=t("Array.prototype.map()"),Fs=t(" callback to add the random characters directly while the array is created. Then, we just have to join the password into a string and we’re done - except for the details of "),Ea=p("code"),zs=t("getRandomCharacter()"),Ys=t(" which we’ll cover soon."),ts=k(),M=p("pre"),os=k(),ia=p("h2"),Qs=t("Cryptographically Secure Random Number Generation"),rs=k(),b=p("p"),Zs=t("Let’s implement "),$a=p("code"),Ks=t("getRandomCharacter()"),Xs=t(". To ensure the characters are randomized in a cryptographically safe way, we use "),Ca=p("code"),ae=t("crypto.getRandomValues()"),se=t(". This is "),Ta=p("em"),ee=t("strongly"),ne=t(" recommended instead of using "),Pa=p("code"),te=t("Math.random()"),oe=t(" which may seem simpler, but is not secure enough for our needs."),ps=k(),V=p("pre"),cs=k(),w=p("p"),re=t("To explain "),Ra=p("code"),pe=t("getRandomCharacter()"),ce=t(", let’s start by thinking about the character set again. Since our character set has less than 256 characters (8 bytes), we can pass an "),ja=p("code"),le=t("Uint8Array"),ie=t(" to "),Aa=p("code"),ue=t("crypto.getRandomValues()"),ke=t(", to fill it with random numbers. In our case, this will be a single number between 0-255 since we created an "),xa=p("code"),me=t("Uint8Array"),de=t(" with "),Sa=p("code"),he=t("1"),fe=t(" byte. We’ll retrieve the "),Na=p("code"),we=t("randomNumber"),ye=t(" and can now use this to calculate the random index from where to pick the next character."),ls=k(),T=p("p"),ge=t("Since our character set contains less than 256 characters, we need to ensure the random number isn’t out of range to avoid crashes. This can be done using "),Da=p("code"),be=t("%"),_e=t(" - the "),K(A.$$.fragment),ve=t(", which allows us to use a random number potentially much larger than our character set length, and always get a value within our desired range."),is=k(),g=p("p"),Ee=t("However, this method has a severe security issue - it will cause the first characters in our set to appear more often, greatly reducing the password security. This is caused by the fact that the result when using the remainder operator will restart from 0 once "),Oa=p("code"),$e=t("randomNumber"),Ce=t(" has reached another multiple of the character set length. "),Ha=p("code"),Te=t("39 % 40"),Pe=t(" yields "),La=p("code"),Re=t("39"),je=t(" and "),Ia=p("code"),Ae=t("40 % 40"),xe=t(" yields "),Wa=p("code"),Se=t("0"),Ne=t(", meaning we’ll get the last character and then the first character again. This repeats for larger multiples such as 80 and so on, until the final iteration where we’ve reached the final multiple before 255. Then the remaining indices will add additional probability to pick the fist characters with the lowest indices."),us=k(),q=p("pre"),ks=k(),ua=p("h2"),De=t("Ensure Random Characters Have Equal Distribution"),ms=k(),x=p("p"),Oe=t("To work around the issue caused by the remainder operator, we can only allow random numbers that are smaller than the maximum multiple of the character set length that is in turn smaller than 255 (the maximum possible value for our random number when using an "),Ga=p("code"),He=t("Uint8Array"),Le=t(")."),ds=k(),ka=p("p"),Ie=t("To calculate the maximum value, we can use the following expression:"),hs=k(),J=p("pre"),fs=k(),ma=p("p"),We=t("To give an example, this means that a character set length of 60 would yield the maximum random number 240, since 240 is the largest number that is both less than 256 and evenly divisible by 60."),ws=k(),B=p("pre"),ys=k(),_=p("p"),Ge=t("Getting back to implementing "),Ua=p("code"),Ue=t("getRandomCharacter()"),Me=t(", the next step would be to ensure that the we regenerate "),Ma=p("code"),Ve=t("randomNumber"),qe=t(" as long as it’s larger than our maximum allowed value. In the final version of "),Va=p("code"),Je=t("getRandomCharacter()"),Be=t(", we’ll use a "),K(S.$$.fragment),Fe=t(" loop to achieve this:"),gs=k(),F=p("pre"),bs=k(),da=p("h2"),ze=t("The Finished Password Generator"),_s=k(),ha=p("p"),Ye=t("Here’s how the generator looks when all pieces come together!"),vs=k(),z=p("pre"),Es=k(),N=p("h2"),Qe=t("Generate Passwords with "),qa=p("code"),Ze=t("pagecrypt"),Ke=t(" in Your Next Project"),$s=k(),D=p("p"),Xe=t("This post is based on what I learned while creating the "),K(O.$$.fragment),an=t(" package which implements the code from this blog post, along with other related Web Crypto utilities. Since pagecrypt is just a standard ES module, it works with any JavaScript framework both on the frontend and the backend."),Cs=k(),fa=p("p"),sn=t("Install it with"),Ts=k(),Y=p("pre"),Ps=k(),H=p("p"),en=t("Then, you can generate random passwords both in "),K(L.$$.fragment),nn=t(" and Node.js newer than v15."),Rs=k(),Q=p("pre"),js=k(),wa=p("p"),Ja=p("strong"),tn=t("Enjoy!"),As=k(),ya=p("p"),on=t("Let me know if you have any suggestions and further improvements!"),this.h()},l(a){i=c(a,"P",{});var n=l(i);u=o(n,"Strong, cryptographically safe passwords are an essential foundation to live a secure digital life. With an open source password manager like "),X(d.$$.fragment,n),W=o(n,", it’s never been more accessible to generate unique, strong passwords for every online account, and then storing them in your password vault."),n.forEach(s),h=m(a),y=c(a,"P",{});var Z=l(y);ta=o(Z,"But what if you want to add password generation directly to your web app? That’s recently been getting much more accessible as well thanks to the standard "),X(j.$$.fragment,Z),Ls=o(Z,"."),Z.forEach(s),Qa=m(a),oa=c(a,"H2",{});var Ba=l(oa);Is=o(Ba,"Use the Web Crypto API in Any Environment"),Ba.forEach(s),Za=m(a),ra=c(a,"P",{});var Fa=l(ra);Ws=o(Fa,"In order to make the generator work in both browsers and Node.js, we need an abstraction. This ensures we can use the same Web Crypto API no matter where the generator is used."),Fa.forEach(s),Ka=m(a),G=c(a,"PRE",{class:!0});var Ss=l(G);Ss.forEach(s),Xa=m(a),pa=c(a,"H2",{});var za=l(pa);Gs=o(za,"Creating a Password by Selecting Random Characters"),za.forEach(s),as=m(a),ca=c(a,"P",{});var Ya=l(ca);Us=o(Ya,"The way our generator is going to work is by creating an array of a given length (matching the password length), and then filling it with random characters."),Ya.forEach(s),ss=m(a),la=c(a,"P",{});var pn=l(la);Ms=o(pn,"First, we’ll import the crypto abstraction and define the character set we want to use."),pn.forEach(s),es=m(a),U=c(a,"PRE",{class:!0});var nt=l(U);nt.forEach(s),ns=m(a),E=c(a,"P",{});var I=l(E);Vs=o(I,"Using "),_a=c(I,"CODE",{});var cn=l(_a);qs=o(cn,"Array.from()"),cn.forEach(s),Js=o(I,", we can provide a "),va=c(I,"CODE",{});var ln=l(va);Bs=o(ln,"Array.prototype.map()"),ln.forEach(s),Fs=o(I," callback to add the random characters directly while the array is created. Then, we just have to join the password into a string and we’re done - except for the details of "),Ea=c(I,"CODE",{});var un=l(Ea);zs=o(un,"getRandomCharacter()"),un.forEach(s),Ys=o(I," which we’ll cover soon."),I.forEach(s),ts=m(a),M=c(a,"PRE",{class:!0});var tt=l(M);tt.forEach(s),os=m(a),ia=c(a,"H2",{});var kn=l(ia);Qs=o(kn,"Cryptographically Secure Random Number Generation"),kn.forEach(s),rs=m(a),b=c(a,"P",{});var P=l(b);Zs=o(P,"Let’s implement "),$a=c(P,"CODE",{});var mn=l($a);Ks=o(mn,"getRandomCharacter()"),mn.forEach(s),Xs=o(P,". To ensure the characters are randomized in a cryptographically safe way, we use "),Ca=c(P,"CODE",{});var dn=l(Ca);ae=o(dn,"crypto.getRandomValues()"),dn.forEach(s),se=o(P,". This is "),Ta=c(P,"EM",{});var hn=l(Ta);ee=o(hn,"strongly"),hn.forEach(s),ne=o(P," recommended instead of using "),Pa=c(P,"CODE",{});var fn=l(Pa);te=o(fn,"Math.random()"),fn.forEach(s),oe=o(P," which may seem simpler, but is not secure enough for our needs."),P.forEach(s),ps=m(a),V=c(a,"PRE",{class:!0});var ot=l(V);ot.forEach(s),cs=m(a),w=c(a,"P",{});var v=l(w);re=o(v,"To explain "),Ra=c(v,"CODE",{});var wn=l(Ra);pe=o(wn,"getRandomCharacter()"),wn.forEach(s),ce=o(v,", let’s start by thinking about the character set again. Since our character set has less than 256 characters (8 bytes), we can pass an "),ja=c(v,"CODE",{});var yn=l(ja);le=o(yn,"Uint8Array"),yn.forEach(s),ie=o(v," to "),Aa=c(v,"CODE",{});var gn=l(Aa);ue=o(gn,"crypto.getRandomValues()"),gn.forEach(s),ke=o(v,", to fill it with random numbers. In our case, this will be a single number between 0-255 since we created an "),xa=c(v,"CODE",{});var bn=l(xa);me=o(bn,"Uint8Array"),bn.forEach(s),de=o(v," with "),Sa=c(v,"CODE",{});var _n=l(Sa);he=o(_n,"1"),_n.forEach(s),fe=o(v," byte. We’ll retrieve the "),Na=c(v,"CODE",{});var vn=l(Na);we=o(vn,"randomNumber"),vn.forEach(s),ye=o(v," and can now use this to calculate the random index from where to pick the next character."),v.forEach(s),ls=m(a),T=c(a,"P",{});var ga=l(T);ge=o(ga,"Since our character set contains less than 256 characters, we need to ensure the random number isn’t out of range to avoid crashes. This can be done using "),Da=c(ga,"CODE",{});var En=l(Da);be=o(En,"%"),En.forEach(s),_e=o(ga," - the "),X(A.$$.fragment,ga),ve=o(ga,", which allows us to use a random number potentially much larger than our character set length, and always get a value within our desired range."),ga.forEach(s),is=m(a),g=c(a,"P",{});var $=l(g);Ee=o($,"However, this method has a severe security issue - it will cause the first characters in our set to appear more often, greatly reducing the password security. This is caused by the fact that the result when using the remainder operator will restart from 0 once "),Oa=c($,"CODE",{});var $n=l(Oa);$e=o($n,"randomNumber"),$n.forEach(s),Ce=o($," has reached another multiple of the character set length. "),Ha=c($,"CODE",{});var Cn=l(Ha);Te=o(Cn,"39 % 40"),Cn.forEach(s),Pe=o($," yields "),La=c($,"CODE",{});var Tn=l(La);Re=o(Tn,"39"),Tn.forEach(s),je=o($," and "),Ia=c($,"CODE",{});var Pn=l(Ia);Ae=o(Pn,"40 % 40"),Pn.forEach(s),xe=o($," yields "),Wa=c($,"CODE",{});var Rn=l(Wa);Se=o(Rn,"0"),Rn.forEach(s),Ne=o($,", meaning we’ll get the last character and then the first character again. This repeats for larger multiples such as 80 and so on, until the final iteration where we’ve reached the final multiple before 255. Then the remaining indices will add additional probability to pick the fist characters with the lowest indices."),$.forEach(s),us=m(a),q=c(a,"PRE",{class:!0});var rt=l(q);rt.forEach(s),ks=m(a),ua=c(a,"H2",{});var jn=l(ua);De=o(jn,"Ensure Random Characters Have Equal Distribution"),jn.forEach(s),ms=m(a),x=c(a,"P",{});var Ns=l(x);Oe=o(Ns,"To work around the issue caused by the remainder operator, we can only allow random numbers that are smaller than the maximum multiple of the character set length that is in turn smaller than 255 (the maximum possible value for our random number when using an "),Ga=c(Ns,"CODE",{});var An=l(Ga);He=o(An,"Uint8Array"),An.forEach(s),Le=o(Ns,")."),Ns.forEach(s),ds=m(a),ka=c(a,"P",{});var xn=l(ka);Ie=o(xn,"To calculate the maximum value, we can use the following expression:"),xn.forEach(s),hs=m(a),J=c(a,"PRE",{class:!0});var pt=l(J);pt.forEach(s),fs=m(a),ma=c(a,"P",{});var Sn=l(ma);We=o(Sn,"To give an example, this means that a character set length of 60 would yield the maximum random number 240, since 240 is the largest number that is both less than 256 and evenly divisible by 60."),Sn.forEach(s),ws=m(a),B=c(a,"PRE",{class:!0});var ct=l(B);ct.forEach(s),ys=m(a),_=c(a,"P",{});var R=l(_);Ge=o(R,"Getting back to implementing "),Ua=c(R,"CODE",{});var Nn=l(Ua);Ue=o(Nn,"getRandomCharacter()"),Nn.forEach(s),Me=o(R,", the next step would be to ensure that the we regenerate "),Ma=c(R,"CODE",{});var Dn=l(Ma);Ve=o(Dn,"randomNumber"),Dn.forEach(s),qe=o(R," as long as it’s larger than our maximum allowed value. In the final version of "),Va=c(R,"CODE",{});var On=l(Va);Je=o(On,"getRandomCharacter()"),On.forEach(s),Be=o(R,", we’ll use a "),X(S.$$.fragment,R),Fe=o(R," loop to achieve this:"),R.forEach(s),gs=m(a),F=c(a,"PRE",{class:!0});var lt=l(F);lt.forEach(s),bs=m(a),da=c(a,"H2",{});var Hn=l(da);ze=o(Hn,"The Finished Password Generator"),Hn.forEach(s),_s=m(a),ha=c(a,"P",{});var Ln=l(ha);Ye=o(Ln,"Here’s how the generator looks when all pieces come together!"),Ln.forEach(s),vs=m(a),z=c(a,"PRE",{class:!0});var it=l(z);it.forEach(s),Es=m(a),N=c(a,"H2",{});var Ds=l(N);Qe=o(Ds,"Generate Passwords with "),qa=c(Ds,"CODE",{});var In=l(qa);Ze=o(In,"pagecrypt"),In.forEach(s),Ke=o(Ds," in Your Next Project"),Ds.forEach(s),$s=m(a),D=c(a,"P",{});var Os=l(D);Xe=o(Os,"This post is based on what I learned while creating the "),X(O.$$.fragment,Os),an=o(Os," package which implements the code from this blog post, along with other related Web Crypto utilities. Since pagecrypt is just a standard ES module, it works with any JavaScript framework both on the frontend and the backend."),Os.forEach(s),Cs=m(a),fa=c(a,"P",{});var Wn=l(fa);sn=o(Wn,"Install it with"),Wn.forEach(s),Ts=m(a),Y=c(a,"PRE",{class:!0});var ut=l(Y);ut.forEach(s),Ps=m(a),H=c(a,"P",{});var Hs=l(H);en=o(Hs,"Then, you can generate random passwords both in "),X(L.$$.fragment,Hs),nn=o(Hs," and Node.js newer than v15."),Hs.forEach(s),Rs=m(a),Q=c(a,"PRE",{class:!0});var kt=l(Q);kt.forEach(s),js=m(a),wa=c(a,"P",{});var Gn=l(wa);Ja=c(Gn,"STRONG",{});var Un=l(Ja);tn=o(Un,"Enjoy!"),Un.forEach(s),Gn.forEach(s),As=m(a),ya=c(a,"P",{});var Mn=l(ya);on=o(Mn,"Let me know if you have any suggestions and further improvements!"),Mn.forEach(s),this.h()},h(){C(G,"class","language-js"),C(U,"class","language-js"),C(M,"class","language-js"),C(V,"class","language-js"),C(q,"class","language-js"),C(J,"class","language-js"),C(B,"class","language-js"),C(F,"class","language-js"),C(z,"class","language-js"),C(Y,"class","language-shell"),C(Q,"class","language-js")},m(a,n){r(a,i,n),e(i,u),aa(d,i,null),e(i,W),r(a,h,n),r(a,y,n),e(y,ta),aa(j,y,null),e(y,Ls),r(a,Qa,n),r(a,oa,n),e(oa,Is),r(a,Za,n),r(a,ra,n),e(ra,Ws),r(a,Ka,n),r(a,G,n),G.innerHTML=Bn,r(a,Xa,n),r(a,pa,n),e(pa,Gs),r(a,as,n),r(a,ca,n),e(ca,Us),r(a,ss,n),r(a,la,n),e(la,Ms),r(a,es,n),r(a,U,n),U.innerHTML=Fn,r(a,ns,n),r(a,E,n),e(E,Vs),e(E,_a),e(_a,qs),e(E,Js),e(E,va),e(va,Bs),e(E,Fs),e(E,Ea),e(Ea,zs),e(E,Ys),r(a,ts,n),r(a,M,n),M.innerHTML=zn,r(a,os,n),r(a,ia,n),e(ia,Qs),r(a,rs,n),r(a,b,n),e(b,Zs),e(b,$a),e($a,Ks),e(b,Xs),e(b,Ca),e(Ca,ae),e(b,se),e(b,Ta),e(Ta,ee),e(b,ne),e(b,Pa),e(Pa,te),e(b,oe),r(a,ps,n),r(a,V,n),V.innerHTML=Yn,r(a,cs,n),r(a,w,n),e(w,re),e(w,Ra),e(Ra,pe),e(w,ce),e(w,ja),e(ja,le),e(w,ie),e(w,Aa),e(Aa,ue),e(w,ke),e(w,xa),e(xa,me),e(w,de),e(w,Sa),e(Sa,he),e(w,fe),e(w,Na),e(Na,we),e(w,ye),r(a,ls,n),r(a,T,n),e(T,ge),e(T,Da),e(Da,be),e(T,_e),aa(A,T,null),e(T,ve),r(a,is,n),r(a,g,n),e(g,Ee),e(g,Oa),e(Oa,$e),e(g,Ce),e(g,Ha),e(Ha,Te),e(g,Pe),e(g,La),e(La,Re),e(g,je),e(g,Ia),e(Ia,Ae),e(g,xe),e(g,Wa),e(Wa,Se),e(g,Ne),r(a,us,n),r(a,q,n),q.innerHTML=Qn,r(a,ks,n),r(a,ua,n),e(ua,De),r(a,ms,n),r(a,x,n),e(x,Oe),e(x,Ga),e(Ga,He),e(x,Le),r(a,ds,n),r(a,ka,n),e(ka,Ie),r(a,hs,n),r(a,J,n),J.innerHTML=Zn,r(a,fs,n),r(a,ma,n),e(ma,We),r(a,ws,n),r(a,B,n),B.innerHTML=Kn,r(a,ys,n),r(a,_,n),e(_,Ge),e(_,Ua),e(Ua,Ue),e(_,Me),e(_,Ma),e(Ma,Ve),e(_,qe),e(_,Va),e(Va,Je),e(_,Be),aa(S,_,null),e(_,Fe),r(a,gs,n),r(a,F,n),F.innerHTML=Xn,r(a,bs,n),r(a,da,n),e(da,ze),r(a,_s,n),r(a,ha,n),e(ha,Ye),r(a,vs,n),r(a,z,n),z.innerHTML=at,r(a,Es,n),r(a,N,n),e(N,Qe),e(N,qa),e(qa,Ze),e(N,Ke),r(a,$s,n),r(a,D,n),e(D,Xe),aa(O,D,null),e(D,an),r(a,Cs,n),r(a,fa,n),e(fa,sn),r(a,Ts,n),r(a,Y,n),Y.innerHTML=st,r(a,Ps,n),r(a,H,n),e(H,en),aa(L,H,null),e(H,nn),r(a,Rs,n),r(a,Q,n),Q.innerHTML=et,r(a,js,n),r(a,wa,n),e(wa,Ja),e(Ja,tn),r(a,As,n),r(a,ya,n),e(ya,on),xs=!0},p(a,n){const Z={};n&2&&(Z.$$scope={dirty:n,ctx:a}),d.$set(Z);const Ba={};n&2&&(Ba.$$scope={dirty:n,ctx:a}),j.$set(Ba);const Fa={};n&2&&(Fa.$$scope={dirty:n,ctx:a}),A.$set(Fa);const Ss={};n&2&&(Ss.$$scope={dirty:n,ctx:a}),S.$set(Ss);const za={};n&2&&(za.$$scope={dirty:n,ctx:a}),O.$set(za);const Ya={};n&2&&(Ya.$$scope={dirty:n,ctx:a}),L.$set(Ya)},i(a){xs||(sa(d.$$.fragment,a),sa(j.$$.fragment,a),sa(A.$$.fragment,a),sa(S.$$.fragment,a),sa(O.$$.fragment,a),sa(L.$$.fragment,a),xs=!0)},o(a){ea(d.$$.fragment,a),ea(j.$$.fragment,a),ea(A.$$.fragment,a),ea(S.$$.fragment,a),ea(O.$$.fragment,a),ea(L.$$.fragment,a),xs=!1},d(a){a&&s(i),na(d),a&&s(h),a&&s(y),na(j),a&&s(Qa),a&&s(oa),a&&s(Za),a&&s(ra),a&&s(Ka),a&&s(G),a&&s(Xa),a&&s(pa),a&&s(as),a&&s(ca),a&&s(ss),a&&s(la),a&&s(es),a&&s(U),a&&s(ns),a&&s(E),a&&s(ts),a&&s(M),a&&s(os),a&&s(ia),a&&s(rs),a&&s(b),a&&s(ps),a&&s(V),a&&s(cs),a&&s(w),a&&s(ls),a&&s(T),na(A),a&&s(is),a&&s(g),a&&s(us),a&&s(q),a&&s(ks),a&&s(ua),a&&s(ms),a&&s(x),a&&s(ds),a&&s(ka),a&&s(hs),a&&s(J),a&&s(fs),a&&s(ma),a&&s(ws),a&&s(B),a&&s(ys),a&&s(_),na(S),a&&s(gs),a&&s(F),a&&s(bs),a&&s(da),a&&s(_s),a&&s(ha),a&&s(vs),a&&s(z),a&&s(Es),a&&s(N),a&&s($s),a&&s(D),na(O),a&&s(Cs),a&&s(fa),a&&s(Ts),a&&s(Y),a&&s(Ps),a&&s(H),na(L),a&&s(Rs),a&&s(Q),a&&s(js),a&&s(wa),a&&s(As),a&&s(ya)}}}function Ct(f){let i,u;const d=[f[0],Jn];let W={$$slots:{default:[$t]},$$scope:{ctx:f}};for(let h=0;h<d.length;h+=1)W=rn(W,d[h]);return i=new wt({props:W}),{c(){K(i.$$.fragment)},l(h){X(i.$$.fragment,h)},m(h,y){aa(i,h,y),u=!0},p(h,[y]){const ta=y&1?ft(d,[y&1&&Vn(h[0]),y&0&&Vn(Jn)]):{};y&2&&(ta.$$scope={dirty:y,ctx:h}),i.$set(ta)},i(h){u||(sa(i.$$.fragment,h),u=!0)},o(h){ea(i.$$.fragment,h),u=!1},d(h){na(i,h)}}}const Jn={title:"Use the Web Crypto API to Generate a Cryptographically Secure Password in the Browser and Node.js",date:"2021-07-28T00:00:00.000Z",tags:["JavaScript","Web Crypto API","Node.js"],featured:!0};function Tt(f,i,u){return f.$$set=d=>{u(0,i=rn(rn({},i),qn(d)))},i=qn(i),[i]}class At extends mt{constructor(i){super(),dt(this,i,Tt,Ct,ht,{})}}export{At as default,Jn as metadata};
