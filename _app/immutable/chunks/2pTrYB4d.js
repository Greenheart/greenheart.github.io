import{f as $,a as n,t as o}from"./Bp23vAW-.js";import{L as l}from"./kWG-pE-1.js";import{s as t,c as p,n as a,r as c}from"./GZG48BUc.js";import{C as k}from"./Bu2iz0Bf.js";const R="testing-rust-cli-apps",x={title:"Testing Rust-based CLI applications using temporary directories",publishedAt:"2026-01-17",tags:["Rust","Terminal","Open Source"],featured:!0},{title:j,publishedAt:G,tags:S,featured:O}=x;var I=$("<article><p>I recently finished reading the book <!>, experimenting with the exercises and adding more test cases. While the testing chapter covers the <!>, it didn't show the full potential of the recommended crates <!>, <!> and <!>.</p><p>Specifically, I wondered how to create a temporary directory with multiple nested subdirectories and files. This is very useful for testing CLI tools that scaffold projects. Or in the case of my current Rust project, building a simple Git clone to learn more about how Git works internally, how to structure unit and integration tests in Rust, and to practice using the language.</p><p>Since I'm used to reading technical documentation and learning new technologies, I found what I needed without too much trouble by exploring <!> to learn about temporary directories, and <!> for executing the CLI app in a specific working directory. However, this seemed like a good opportunity to improve the Rust CLI book itself, to make common testing techniques easier to discover for people who might be new(er) to programming and not yet comfortable with jumping into technical documentation. I remember how much I valued these types of friendly and accessible descriptions when I started more than a decade ago, and these days I think they are important to make software development more accessible.</p><p>So I ended up <!> a new section describing the following example to hopefully make the book even better. If you're curious about how it works, I encourage you to read the <!> which gives some more context.</p><!><p>Making this change was also a good opportunity to learn more about how <!> works, which is commonly used for many Rust books and technical tutorials. I really enjoyed how fast it builds, and even runs tests for the code samples to verify everything works as expected. This makes technical writing such a smooth experience.</p><p>And speaking of the Git clone, it's coming together nicely and has already taught me a lot about both Rust programming and how to create integration tests that simulate a Git repository. In fact, these testing techniques already helped me catch a regression while refactoring to reuse some code between <code>git cat-file</code> and <code>git ls-tree</code>, so this knowledge has already proven useful!</p></article>");function q(C){var i=I(),d=p(i),h=t(p(d));l(h,{href:"https://rust-cli.github.io/book/",children:(s,r)=>{a();var e=o("Command Line Applications in Rust");n(s,e)},$$slots:{default:!0}});var u=t(h,2);l(u,{href:"https://rust-cli.github.io/book/tutorial/testing.html",children:(s,r)=>{a();var e=o("basics of testing CLI apps");n(s,e)},$$slots:{default:!0}});var f=t(u,2);l(f,{href:"https://crates.io/crates/assert_cmd",children:(s,r)=>{a();var e=o("assert_cmd");n(s,e)},$$slots:{default:!0}});var m=t(f,2);l(m,{href:"https://crates.io/crates/assert_fs",children:(s,r)=>{a();var e=o("assert_fs");n(s,e)},$$slots:{default:!0}});var b=t(m,2);l(b,{href:"https://crates.io/crates/predicates",children:(s,r)=>{a();var e=o("predicates");n(s,e)},$$slots:{default:!0}}),a(),c(d);var B=t(d,2),F=t(p(B));l(F,{href:"https://docs.rs/assert_fs/latest/assert_fs/struct.TempDir.html",children:(s,r)=>{a();var e=o("docs.rs/assert_fs");n(s,e)},$$slots:{default:!0}});var v=t(F,2);l(v,{href:"https://docs.rs/assert_cmd/latest/assert_cmd/cmd/struct.Command.html#method.current_dir",children:(s,r)=>{a();var e=o("docs.rs/assert_cmd");n(s,e)},$$slots:{default:!0}}),a(),c(B);var y=t(B),A=t(p(y));l(A,{href:"https://github.com/rust-cli/book/pull/284",children:(s,r)=>{a();var e=o("contributing");n(s,e)},$$slots:{default:!0}});var w=t(A,2);l(w,{href:"https://github.com/rust-cli/book/pull/284/files",children:(s,r)=>{a();var e=o("full version");n(s,e)},$$slots:{default:!0}}),a(),c(y);var g=t(y);k(g,{codeHTML:`<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">#[test]</span></span>
<span class="line"><span style="color:#C678DD">fn</span><span style="color:#61AFEF"> find_content_in_file_of_tmp_dir</span><span style="color:#ABB2BF">() -> </span><span style="color:#E5C07B">Result</span><span style="color:#ABB2BF">&#x3C;(), </span><span style="color:#E5C07B">Box</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#C678DD">dyn</span><span style="color:#E06C75"> std</span><span style="color:#ABB2BF">::</span><span style="color:#E06C75">error</span><span style="color:#ABB2BF">::</span><span style="color:#E5C07B">Error</span><span style="color:#ABB2BF">>> {</span></span>
<span class="line"><span style="color:#C678DD">    let</span><span style="color:#E06C75"> cwd</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> assert_fs</span><span style="color:#ABB2BF">::</span><span style="color:#E5C07B">TempDir</span><span style="color:#ABB2BF">::</span><span style="color:#61AFEF">new</span><span style="color:#ABB2BF">()?;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    let</span><span style="color:#E06C75"> child_dir</span><span style="color:#56B6C2"> =</span><span style="color:#E06C75"> cwd</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">child</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"nested/child_dir"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">    let</span><span style="color:#E06C75"> child_file</span><span style="color:#56B6C2"> =</span><span style="color:#E06C75"> child_dir</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">child</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"sample.txt"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    child_file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">write_str</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"The first</span><span style="color:#56B6C2">\\n</span><span style="color:#98C379">test file.</span><span style="color:#56B6C2">\\n</span><span style="color:#98C379">Last line of first file."</span><span style="color:#ABB2BF">)?;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    // Files can be nested several levels within the temporary directory</span></span>
<span class="line"><span style="color:#61AFEF">    assert!</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">child_file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">path</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">ends_with</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"nested/child_dir/sample.txt"</span><span style="color:#ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF">    cargo_bin_cmd!</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"grrs"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        // Execute in the temporary directory</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">current_dir</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">cwd</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">path</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">arg</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"first"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">arg</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">child_file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">path</span><span style="color:#ABB2BF">())</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">assert</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">success</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">stdout</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">predicate</span><span style="color:#ABB2BF">::</span><span style="color:#E5C07B">str</span><span style="color:#ABB2BF">::</span><span style="color:#61AFEF">contains</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#98C379">            "The first</span><span style="color:#56B6C2">\\n</span><span style="color:#98C379">Last line of first file."</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">        ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Ok</span><span style="color:#ABB2BF">(())</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code></pre>`});var _=t(g),E=t(p(_));l(E,{href:"https://github.com/rust-lang/mdBook",children:(s,r)=>{a();var e=o("mdBook");n(s,e)},$$slots:{default:!0}}),a(),c(_),a(),c(i),n(C,i)}export{q as default,x as frontmatter,R as slug};
